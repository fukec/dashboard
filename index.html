/**
 * OPRAVEN√ù INDEX.HTML - KOMPLETN√ç ≈òE≈†EN√ç
 * ≈òe≈°√≠ probl√©m s naƒç√≠t√°n√≠m modul≈Ø spr√°vn√Ωm zp≈Øsobem
 */
<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- CSS soubory -->
    <link href="style-1.css" rel="stylesheet">
    <link href="widgets.css" rel="stylesheet">
</head>
<body class="bg-light">

<!-- Preloader -->
<div id="preloader" class="d-flex justify-content-center align-items-center position-fixed w-100 h-100" style="z-index: 9999; background: rgba(248, 249, 250, 0.95); backdrop-filter: blur(5px);">
    <div class="text-center">
        <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Naƒç√≠t√°m...</span>
        </div>
        <h5 class="text-primary mb-2">Inicializace dashboard...</h5>
        <p class="text-muted small">Google Sheets Dashboard</p>
    </div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="position-fixed top-0 start-0 w-100 h-100 d-none" style="z-index: 1050; background: rgba(0,0,0,0.5);">
    <div class="d-flex justify-content-center align-items-center h-100">
        <div class="card border-0 shadow">
            <div class="card-body text-center">
                <div class="spinner-border text-primary mb-3" role="status">
                    <span class="visually-hidden">Naƒç√≠t√°m...</span>
                </div>
                <h6 class="mb-2">Naƒç√≠t√°m data z Google Sheets...</h6>
                <p class="text-muted small mb-0">P≈ôipojuji se k datov√Ωm zdroj≈Øm...</p>
                <div class="progress mt-3" style="height: 4px;">
                    <div id="loadingProgress" class="progress-bar" role="progressbar" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Main Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm sticky-top">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="#">
            <i class="fas fa-chart-line me-2"></i>Dashboard p≈ôehled
        </a>
        
        <div class="navbar-nav ms-auto d-flex flex-row">
            <span class="navbar-text me-3">
                <i class="fas fa-clock me-1"></i>
                <span id="lastUpdateTime">--:--</span>
            </span>
            <button class="btn btn-outline-light btn-sm me-2" id="loadDataBtn" title="Naƒç√≠st data">
                <i id="loadDataIcon" class="fas fa-sync-alt me-1"></i>Naƒç√≠st data
            </button>
            <button class="btn btn-outline-light btn-sm me-2" id="configDataSources" title="Konfigurace zdroj≈Ø">
                <i class="fas fa-database me-1"></i>Zdroje
            </button>
            <button class="btn btn-outline-light btn-sm me-2" id="configWidgets" title="Konfigurace widget≈Ø">
                <i class="fas fa-puzzle-piece me-1"></i>Widgety
            </button>
            <button class="btn btn-outline-light btn-sm" id="themeToggle" title="P≈ôepnout t√©ma">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </div>
</nav>

<!-- Main Content -->
<main class="container-fluid py-4">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h1 class="h4 mb-1 text-primary">
                                <i class="fas fa-chart-line me-2"></i>Dashboard p≈ôehled
                            </h1>
                            <p class="text-muted mb-0">Real-time data z Google Sheets</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="d-flex justify-content-end align-items-center">
                                <span class="badge bg-success me-2">
                                    <i class="fas fa-circle me-1" style="font-size: 0.5rem;"></i>Online
                                </span>
                                <small class="text-muted">
                                    Posledn√≠ aktualizace: <span id="lastUpdate">--:--</span>
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Grid -->
    <div id="dashboardGrid" class="row">
        <!-- Widgety budou dynamicky vkl√°d√°ny zde -->
    </div>

    <!-- Empty Dashboard State -->
    <div id="emptyDashboard" class="text-center py-5" style="display: none;">
        <div class="card border-0 shadow-sm">
            <div class="card-body py-5">
                <i class="fas fa-chart-line fa-3x text-muted mb-3"></i>
                <h4 class="text-muted">Dashboard je pr√°zdn√Ω</h4>
                <p class="text-muted mb-4">P≈ôidejte datov√© zdroje a widgety pro zobrazen√≠ dat</p>
                <button class="btn btn-primary me-2" id="addDataSourceBtn">
                    <i class="fas fa-database me-2"></i>P≈ôidat datov√Ω zdroj
                </button>
                <button class="btn btn-outline-primary" id="addWidgetBtn">
                    <i class="fas fa-puzzle-piece me-2"></i>P≈ôidat widget
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Status -->
    <div id="loadingStatus" class="text-center text-muted" style="display: none;">
        Inicializuji...
    </div>
</main>

<!-- Toast Container -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <!-- Toasts budou dynamicky p≈ôid√°v√°ny -->
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- OPRAVEN√â NAƒå√çT√ÅN√ç MODUL≈Æ - S GLOB√ÅLN√çM VYSTAVEN√çM -->
<script>
// KROK 1: Naƒçti v≈°echny JavaScript soubory a vystav t≈ô√≠dy glob√°lnƒõ
console.log('üì¶ Naƒç√≠t√°m JavaScript moduly...');

// Funkce pro dynamick√© naƒç√≠t√°n√≠ skript≈Ø
function loadScript(src) {
    return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        script.onload = resolve;
        script.onerror = reject;
        document.head.appendChild(script);
    });
}

// Naƒçti moduly v po≈ôad√≠
Promise.all([
    loadScript('data-manager.js'),
    loadScript('config-manager.js'), 
    loadScript('widget-factory.js'),
    loadScript('detail-modal.js'),
    loadScript('dashboard-core.js')
]).then(() => {
    console.log('‚úÖ V≈°echny moduly naƒçteny');
    
    // KROK 2: Manu√°lnƒõ vystav t≈ô√≠dy do glob√°ln√≠ho scope
    // (proto≈æe p≈Øvodn√≠ soubory je nevystavuj√≠)
    
    // Zkontroluj, kter√© t≈ô√≠dy jsou dostupn√©
    const availableClasses = [];
    
    if (typeof DataManager !== 'undefined') {
        window.DataManager = DataManager;
        availableClasses.push('DataManager');
    }
    
    if (typeof ConfigManager !== 'undefined') {
        window.ConfigManager = ConfigManager;
        availableClasses.push('ConfigManager');
    }
    
    if (typeof WidgetFactory !== 'undefined') {
        window.WidgetFactory = WidgetFactory;
        availableClasses.push('WidgetFactory');
    }
    
    if (typeof DetailModal !== 'undefined') {
        window.DetailModal = DetailModal;
        availableClasses.push('DetailModal');
    }
    
    if (typeof DashboardCore !== 'undefined') {
        window.DashboardCore = DashboardCore;
        availableClasses.push('DashboardCore');
    }
    
    console.log('üéØ Dostupn√© t≈ô√≠dy:', availableClasses);
    
    // KROK 3: Inicializace Dashboard
    if (availableClasses.length >= 4) { // Pot≈ôebujeme alespo≈à 4 hlavn√≠ t≈ô√≠dy
        console.log('üöÄ Spou≈°t√≠m inicializaci Dashboard...');
        initializeDashboard();
    } else {
        console.error('‚ùå Nedostatek modul≈Ø pro spu≈°tƒõn√≠:', availableClasses);
        showModuleError('Nepoda≈ôilo se naƒç√≠st v≈°echny pot≈ôebn√© moduly: ' + availableClasses.join(', '));
    }
    
}).catch(error => {
    console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ modul≈Ø:', error);
    showModuleError('Chyba p≈ôi naƒç√≠t√°n√≠ JavaScript modul≈Ø: ' + error.message);
});

// KROK 4: Inicializace Dashboard aplikace
function initializeDashboard() {
    try {
        console.log('üìã Inicializuji Dashboard Core...');
        
        // Vytvo≈ô instanci Dashboard Core
        window.dashboardCore = new DashboardCore();
        
        // Spus≈• inicializaci
        window.dashboardCore.init().then(() => {
            console.log('‚úÖ Dashboard √∫spƒõ≈°nƒõ spu≈°tƒõn!');
            
            // P≈ôidej event listeners pro pr√°zdn√Ω dashboard
            const addDataSourceBtn = document.getElementById('addDataSourceBtn');
            const addWidgetBtn = document.getElementById('addWidgetBtn');
            
            if (addDataSourceBtn) {
                addDataSourceBtn.addEventListener('click', () => {
                    if (window.dashboardCore.configManager) {
                        window.dashboardCore.configManager.openDataSourcesConfig();
                    }
                });
            }
            
            if (addWidgetBtn) {
                addWidgetBtn.addEventListener('click', () => {
                    if (window.dashboardCore.configManager) {
                        window.dashboardCore.configManager.openWidgetsConfig();
                    }
                });
            }
            
        }).catch(error => {
            console.error('‚ùå Chyba p≈ôi inicializaci Dashboard:', error);
            showModuleError('Chyba p≈ôi inicializaci: ' + error.message);
        });
        
    } catch (error) {
        console.error('‚ùå Kritick√° chyba p≈ôi vytv√°≈ôen√≠ Dashboard Core:', error);
        showModuleError('Kritick√° chyba: ' + error.message);
    }
}

// Zobrazen√≠ chyby p≈ôi naƒç√≠t√°n√≠ modul≈Ø
function showModuleError(message) {
    const preloader = document.getElementById('preloader');
    if (preloader) {
        preloader.innerHTML = `
            <div class="text-center">
                <i class="fas fa-exclamation-triangle fa-3x text-danger mb-3"></i>
                <h5 class="text-danger">Chyba p≈ôi naƒç√≠t√°n√≠ aplikace</h5>
                <p class="text-muted">${message}</p>
                <button class="btn btn-primary" onclick="location.reload()">
                    <i class="fas fa-refresh me-2"></i>Zkusit znovu
                </button>
            </div>
        `;
    }
}

// Debug informace
console.log('üìä Dashboard Application Loading...');
console.log('üåê Browser:', navigator.userAgent);
console.log('üìÖ Date:', new Date().toISOString());
</script>

</body>
</html>
