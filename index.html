<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets Dashboard</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- CSS soubory -->
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/widgets.css" rel="stylesheet">
</head>
<body class="bg-light">

<div id="preloader" class="d-flex justify-content-center align-items-center position-fixed w-100 h-100" style="z-index:9999;background:rgba(248,249,250,0.95);backdrop-filter:blur(5px);">
    <div class="text-center">
        <div class="spinner-border text-primary mb-3" role="status" style="width:3rem;height:3rem;"><span class="visually-hidden">Načítám...</span></div>
        <h5 class="text-primary mb-2">Inicializace dashboard...</h5>
        <p class="text-muted small">Google Sheets Dashboard</p>
    </div>
</div>

<div id="loadingOverlay" class="position-fixed top-0 start-0 w-100 h-100 d-none" style="z-index:1050;background:rgba(0,0,0,0.5);">
    <div class="d-flex justify-content-center align-items-center h-100">
        <div class="card border-0 shadow">
            <div class="card-body text-center">
                <div class="spinner-border text-primary mb-3" role="status"><span class="visually-hidden">Načítám...</span></div>
                <h6 class="mb-2">Načítám data z Google Sheets...</h6>
                <p class="text-muted small mb-0">Připojuji se k datovým zdrojům...</p>
                <div class="progress mt-3" style="height:4px;"><div id="loadingProgress" class="progress-bar" role="progressbar" style="width:0%"></div></div>
            </div>
        </div>
    </div>
</div>

<nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top shadow-sm">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="#"><i class="fas fa-chart-line me-2"></i>Dashboard</a>
    <div class="navbar-nav ms-auto d-flex flex-row">
      <span class="navbar-text me-3"><i class="fas fa-clock me-1"></i><span id="lastUpdateTime">--:--</span></span>
      <button id="loadDataBtn" class="btn btn-outline-light btn-sm me-2"><i class="fas fa-sync-alt me-1"></i>Načíst data</button>
      <button id="configDataSources" class="btn btn-outline-light btn-sm me-2"><i class="fas fa-database me-1"></i>Zdroje</button>
      <button id="configWidgets" class="btn btn-outline-light btn-sm me-2"><i class="fas fa-puzzle-piece me-1"></i>Widgety</button>
      <button id="themeToggle" class="btn btn-outline-light btn-sm"><i class="fas fa-moon"></i></button>
    </div>
  </div>
</nav>

<main class="container-fluid py-4">
  <div class="row mb-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div><h1 class="h4 text-primary mb-0"><i class="fas fa-chart-line me-2"></i>Dashboard přehled</h1><p class="text-muted mb-0">Real-time data z Google Sheets</p></div>
          <div class="text-end"><span class="badge bg-success me-2"><i class="fas fa-circle" style="font-size:0.5rem;"></i>Online</span><small class="text-muted">Poslední aktualizace: <span id="lastUpdate">--:--</span></small></div>
        </div>
      </div>
    </div>
  </div>

  <div id="dashboardGrid" class="row"></div>
  <div id="emptyDashboard" class="text-center py-5" style="display:none;"><div class="card border-0 shadow-sm"><div class="card-body py-5"><i class="fas fa-chart-line fa-3x text-muted mb-3"></i><h4 class="text-muted">Dashboard je prázdný</h4><p class="text-muted mb-4">Přidejte datové zdroje a widgety</p><button id="addDataSourceBtn" class="btn btn-primary me-2"><i class="fas fa-database me-2"></i>Přidat zdroj</button><button id="addWidgetBtn" class="btn btn-outline-primary"><i class="fas fa-puzzle-piece me-2"></i>Přidat widget</button></div></div></div>

  <div id="loadingStatus" class="text-center text-muted" style="display:none;">Inicializuji...</div>
</main>

<div class="toast-container position-fixed bottom-0 end-0 p-3"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
const loadScript = src => new Promise((res, rej) => { const s=document.createElement('script'); s.src=src; s.onload=res; s.onerror=rej; document.head.appendChild(s); });
Promise.all([
  loadScript('assets/js/data-manager.js'),
  loadScript('assets/js/config-manager.js'),
  loadScript('assets/js/widget-factory.js'),
  loadScript('assets/js/detail-modal.js'),
  loadScript('assets/js/dashboard-core.js')
]).then(()=>{
  const classes=[];
  if(window.DataManager=typeof DataManager!=='undefined' && DataManager) classes.push('DataManager');
  if(window.ConfigManager=typeof ConfigManager!=='undefined' && ConfigManager) classes.push('ConfigManager');
  if(window.WidgetFactory=typeof WidgetFactory!=='undefined' && WidgetFactory) classes.push('WidgetFactory');
  if(window.DetailModal=typeof DetailModal!=='undefined' && DetailModal) classes.push('DetailModal');
  if(window.DashboardCore=typeof DashboardCore!=='undefined' && DashboardCore) classes.push('DashboardCore');
  if(classes.length>=4) initDashboard(); else showError('Chybějící moduly: '+classes.join(', '));
}).catch(e=>showError('Chyba při načítání modulů: '+e.message));

function initDashboard(){ try{ const app=new DashboardCore(); app.init(); }catch(e){ showError(e.message);} }
function showError(msg){ const p=document.getElementById('preloader'); if(p) p.innerHTML=`<div class="text-center"><i class="fas fa-exclamation-triangle fa-3x text-danger mb-3"></i><h5 class="text-danger">Chyba</h5><p class="text-muted">${msg}</p><button class="btn btn-primary" onclick="location.reload()">Zkusit znovu</button></div>`; }
</script>
